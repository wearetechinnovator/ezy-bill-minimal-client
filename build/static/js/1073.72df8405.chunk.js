"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[1073],{55980:(e,t,n)=>{n.d(t,{A:()=>r});n(65043);var a=n(75105),s=n(23930),i=n(83003),l=n(25878),o=n(70579);const r=e=>{let{open:t}=e;const n=(0,i.wA)();return(0,o.jsx)("div",{className:"item__modal",children:(0,o.jsxs)(a.A,{open:t,size:600,onClose:()=>{n((0,l.L)(!1)),window.location.reload()},children:[(0,o.jsx)(a.A.Header,{children:(0,o.jsx)("h6",{className:"py-2",children:"Add Item"})}),(0,o.jsx)(a.A.Body,{children:(0,o.jsx)(s.AddItemComponent,{})})]})})}},19983:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(83003);const s=e=>{const t=(0,a.d4)((e=>e.userDetail)),n=t.activeCompany;if(t.companies)for(let a of t.companies)if(a._id===n)return"invoice"===e?[a.invoiceInitial,a.invoiceNextCount]:"po"===e?[a.poInitial,a.poNextCount]:"proforma"===e?[a.proformaInitial,a.proformaNextCount]:"quotation"===e?[a.quotationInitial,a.quotationCount]:"creditnote"===e?[a.creditNoteInitial,a.creditNoteCount]:"salesreturn"===e?[a.salesReturnInitial,a.salesReturnCount]:"deliverychalan"===e?[a.deliverChalanInitial,a.deliveryChalanCount]:"purchase"===e?[a.purchaseInitial,a.purchaseNextCount]:null}},75532:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(89379),s=n(88918);const i=()=>{const{getApiData:e}=(0,s.A)(),t=(e,t)=>{const n=t[e].tax/100;return((t[e].qun*t[e].price-t[e].discountPerAmount)*n).toFixed(2)};return{onItemChange:async(t,n,a,s,i,l,o)=>{var r;if((null===(r=s[n])||void 0===r?void 0:r.itemId)===t)return;let c=(await e("item")).data.filter((e=>e._id===t));if(c.length>=0){var d,u,p,m,x,h,v,f,g,j,y,A,b,N,w;let e=[...s];console.log("lengthOfItem",e.length);let t=[],l=(null===(d=c[0])||void 0===d||null===(u=d.category)||void 0===u?void 0:u.tax)||(null===(p=c[0])||void 0===p?void 0:p.tax);const r=a.filter(((e,t)=>e._id===l))[0];e[n].itemName=null===(m=c[0])||void 0===m?void 0:m.title,e[n].itemId=null===(x=c[0])||void 0===x?void 0:x._id,e[n].hsn=(null===(h=c[0])||void 0===h||null===(v=h.category)||void 0===v?void 0:v.hsn)||(null===(f=c[0])||void 0===f?void 0:f.hsn),e[n].unit=null===(g=c[0])||void 0===g?void 0:g.unit,e[n].price="sale"===o?null===(j=c[0])||void 0===j?void 0:j.salePrice:null===(y=c[0])||void 0===y?void 0:y.purchasePrice,e[n].selectedUnit=null===(A=c[0])||void 0===A||null===(b=A.unit[0])||void 0===b?void 0:b.unit,e[n].tax=null!==(N=null===r||void 0===r?void 0:r.gst)&&void 0!==N?N:0,null===(w=c[0])||void 0===w||w.unit.forEach(((e,n)=>{t.push(e.unit)})),e[n].unit=[...t],i(e)}},addItem:(e,t,n,s,i,l)=>{1===e?(console.log("itemRowSet",t.length),n((e=>{const n=(0,a.A)((0,a.A)({},t),{},{rowItem:e.length>0?e[e.length-1].rowItem+1:t.rowItem}),i=[...e,n];return s((e=>(0,a.A)((0,a.A)({},e),{},{items:i}))),i}))):l((e=>{const t=(0,a.A)((0,a.A)({},i),{},{additionalRowsItem:e.length>0?e[e.length-1].additionalRowsItem+1:i.additionalRowsItem}),n=[...e,t];return s((e=>(0,a.A)((0,a.A)({},e),{},{additionalCharge:n}))),n}))},deleteItem:(e,t,n,s,i)=>{1===e?n((e=>{const n=e.filter(((e,n)=>n!==t));return s((e=>(0,a.A)((0,a.A)({},e),{},{items:n}))),n})):i((e=>{const n=e.filter(((e,n)=>n!==t));return s((e=>(0,a.A)((0,a.A)({},e),{},{additionalCharge:n}))),n}))},changeDiscountType:(e,t,n,s,i,l)=>{if("no"!==e.target.value){if("before"===e.target.value&&t.some((e=>parseInt(e.discountPerAmount)>0)))return void l("To apply discount before tax, remove discount on item","warning");s((0,a.A)((0,a.A)({},n),{},{discountType:e.target.value})),i(!1)}else s((0,a.A)((0,a.A)({},n),{},{discountType:e.target.value})),s((e=>(0,a.A)((0,a.A)({},e),{},{discountAmount:(0).toFixed(2),discountPercentage:(0).toFixed(2)}))),i(!0)},calculateFinalAmount:function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"0",l=0,o=0;if(e.forEach(((e,t)=>{e.amount&&(l+=parseFloat(e.amount))})),"no"===t.discountType||""===t.discountType||"before"===t.discountType?o=n()("amount"):"after"===t.discountType&&(o=(n()("amount")-t.discountAmount).toFixed(2)),a)return isNaN(l)?o:(parseFloat(l)+parseFloat(o)).toFixed(0);{let e=isNaN(l)?o:(parseFloat(l)+parseFloat(o)).toFixed(2);return s&&(e="0"===i?parseFloat(e)-parseFloat(s):parseFloat(e)+parseFloat(s)),e}},onPerDiscountAmountChange:(e,t,n,a,s)=>{let i=[...n],l=parseFloat(i[t].price)*parseFloat(i[t].qun),o=(parseFloat(e)/l*100).toFixed(2);"percentage"===i[t].perDiscountType&&"before"!==s.discountType||(i[t].discountPerAmount=isNaN(e)||0===e?(0).toFixed(2):e,i[t].discountPerPercentage=isNaN(o)?(0).toFixed(2):o),a(i)},onPerDiscountPercentageChange:(e,t,n,a,s)=>{let i=[...n],l=parseFloat(i[t].price)*parseFloat(i[t].qun)/100*e;"amount"===i[t].perDiscountType&&"before"!==s.discountType||(i[t].discountPerPercentage=e,i[t].discountPerAmount=l.toFixed(2)),a(i)},calculatePerTaxAmount:t,calculatePerAmount:(e,n)=>{const a=n[e].qun,s=n[e].price,i=n[e].discountPerAmount;return(parseFloat(a*s-i)+parseFloat(t(e,n))).toFixed(2)},onDiscountAmountChange:(e,t,n,s,i)=>{if(null!==t){let t=((e.target.value||(0).toFixed(2))/i()("amount")*100).toFixed(2);s((0,a.A)((0,a.A)({},n),{},{discountAmount:e.target.value,discountPercentage:t}))}}}}},51073:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var a=n(89379),s=n(65043),i=n(5606),l=n(35543),o=n(44074),r=n(75206),c=n(86319),d=n(9435),u=n(88918),p=n(19983),m=n(1880),x=n(66580),h=n(83003),v=(n(73023),n(60309)),f=n(55980),g=n(89771),j=n(53435),y=n(75532),A=n(70579);document.title="Sales Invoice";const b=e=>{var t,n;let{mode:b}=e;const N=(0,d.A)(),{id:w}=(0,x.g)(),I=(0,p.A)("invoice"),{getApiData:T}=(0,u.A)(),F=(0,h.d4)((e=>e.partyModalSlice.show)),P=(0,h.d4)((e=>e.itemModalSlice.show)),C=((0,h.wA)(),(0,x.Zp)()),S={rowItem:1,itemName:"",description:"",hsn:"",qun:"1",qunLeft:0,itemId:"",unit:[],selectedUnit:"",price:"",discountPerAmount:"",discountPerPercentage:"",tax:"",taxAmount:"",amount:"",perDiscountType:"",itemInvoice:[],itemInvoiceList:[],scaneItemCodeValue:""},D={additionalRowsItem:1,particular:"",amount:""},[_,q]=(0,s.useState)([S]),[k,E]=(0,s.useState)([D]),[O,R]=(0,s.useState)({party:"",salesInvoiceNumber:"",invoiceDate:(new Date).toISOString().split("T")[0],DueDate:"",items:_,additionalCharge:k,note:"",terms:"",discountType:"",discountAmount:"",discountPercentage:"",paymentStatus:"0",paymentAccount:"",finalAmount:"",paymentAmount:"",autoRoundOff:!1,roundOffAmount:null,roundOffType:"0"}),L=(null===(t=(0,x.zy)().state)||void 0===t?void 0:t.fromWhichBill)||null,U=(0,s.useRef)(null),[z,J]=(0,s.useState)(null),[Q,B]=(0,s.useState)(null),[H,M]=(0,s.useState)(null),[K,V]=(0,s.useState)(null),[W,Y]=(0,s.useState)(!0),[Z,G]=(0,s.useState)([]),[X,$]=(0,s.useState)([]),[ee,te]=(0,s.useState)([]),[ne,ae]=(0,s.useState)([]),[se,ie]=(0,s.useState)([]),[le,oe]=(0,s.useState)([]),[re,ce]=(0,s.useState)([]),{onItemChange:de,addItem:ue,deleteItem:pe,changeDiscountType:me,calculateFinalAmount:xe}=(0,y.A)();(0,s.useEffect)((()=>{let e="",t=0;const n=n=>{const s=Date.now();if(s-t>80&&(e=""),t=s,1===n.key.length&&(e+=n.key),"Enter"===n.key&&e.length>0){const t=e;e="",console.log("SCANNER:",t),(async e=>{const n=await T("item",null,t);if(null===n||void 0===n||null===(e=n.data)||void 0===e||!e._id)return;const s=n.data._id,i=_.findIndex((e=>String(e.itemId)===String(s)));if(-1!==i)return q((e=>{const t=[...e];return t[i].qun=Number(t[i].qun||0)+1,t})),void(U.current=i);if(1===_.length&&(!_[0].itemId||""===_[0].itemId))return U.current=0,void de(s,0,ee,_,q,G,"sale");const l=(0,a.A)((0,a.A)({},S),{},{rowItem:_.length+1}),o=[..._,l],r=o.length-1;q(o),U.current=r,de(s,r,ee,o,q,G,"sale")})()}};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)}),[_,ee,T,de]);const he=async()=>{try{let e;"edit"!==b&&b?"convert"===b&&"proforma"===L?e="".concat("https://ezy-bill-api.tisindia.net/api/v1","/proforma/get"):"convert"===b&&"quotation"===L&&(e="".concat("https://ezy-bill-api.tisindia.net/api/v1","/quotation/get")):e="".concat("https://ezy-bill-api.tisindia.net/api/v1","/salesinvoice/get");const t=m.A.get("token"),n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,id:w})}),s=await n.json(),i=(0,a.A)({},s.data);delete i.proformaNumber;const l=(0,a.A)((0,a.A)({},i),{},{invoiceDate:s.data.invoiceDate?new Date(s.data.invoiceDate).toISOString().split("T")[0]:""});R((e=>(0,a.A)((0,a.A)({},e),l))),b&&(E([...s.data.additionalCharge]),q([...s.data.items])),"no"!=s.data.discountType&&Y(!1)}catch(e){console.log(e),N("Data not get something went wrong","error")}};(0,s.useEffect)((()=>{w&&he()}),[w,L]),(0,s.useEffect)((()=>{I&&"convert"===b||I&&!b?R((e=>(0,a.A)((0,a.A)({},e),{},{salesInvoiceNumber:I[0]+I[1]}))):I&&"edit"===b&&he()}),[null===I||void 0===I?void 0:I.length,b]),(0,s.useState)((()=>{(async()=>{{const e=await T("item");G([...e.data]);const t=e.data.map((e=>({label:e.title,value:e.title})));oe(t)}{const e=(await T("unit")).data.map((e=>({label:e.title,value:e.title})));$([...e])}{const e=await T("tax"),t=e.data.map((e=>({label:e.title,value:e.gst})));te([...e.data]),ce([...t])}{const e=(await T("party")).data.map((e=>({label:e.name,value:e._id})));ae([...e])}{const e=await T("account");ie([...e.data])}})()}),[]),(0,s.useEffect)((()=>{"before"===O.discountType&&_.length>0&&q((e=>e.map((t=>{const n=(parseFloat(O.discountAmount||0)/parseFloat(t.price||0)*100).toFixed(2),s=(parseFloat(O.discountAmount||0)/parseFloat(e.length)).toFixed(2);return(0,a.A)((0,a.A)({},t),{},{discountPerPercentage:n,discountPerAmount:s})}))))}),[O.discountAmount,_.length]);const ve=(e,t)=>{let n=[..._],a=parseFloat(n[t].price)*parseFloat(n[t].qun),s=(parseFloat(e)/a*100).toFixed(2);"percentage"===n[t].perDiscountType&&"before"!==O.discountType||(n[t].discountPerAmount=isNaN(e)||0===e?(0).toFixed(2):e,n[t].discountPerPercentage=isNaN(s)?(0).toFixed(2):s),q(n)},fe=(e,t)=>{let n=[..._],a=parseFloat(n[t].price)*parseFloat(n[t].qun)/100*e;"amount"===n[t].perDiscountType&&"before"!==O.discountType||(n[t].discountPerPercentage=e,n[t].discountPerAmount=a.toFixed(2)),q(n)},ge=e=>{const t=_[e].tax/100;return((_[e].qun*_[e].price-_[e].discountPerAmount)*t).toFixed(2)},je=e=>{const t=_[e].qun,n=_[e].price,a=_[e].discountPerAmount;return(parseFloat(t*n-a)+parseFloat(ge(e))).toFixed(2)};(0,s.useEffect)((()=>{const e=xe(k,O,ye,O.autoRoundOff,O.roundOffAmount,O.roundOffType);R((t=>(0,a.A)((0,a.A)({},t),{},{finalAmount:e})))}),[_,k,O.autoRoundOff,O.roundOffAmount,O.roundOffType]);const ye=(0,s.useCallback)((()=>e=>{let t=0;return _.forEach(((n,a)=>{"discount"===e?n.discountPerAmount&&(t=(parseFloat(t)+parseFloat(n.discountPerAmount)).toFixed(2)):"tax"===e?t=(parseFloat(t)+parseFloat(ge(a))).toFixed(2):"amount"===e&&(t=(parseFloat(t)+parseFloat(je(a))).toFixed(2))})),isNaN(t)?0:t}),[_,z,Q,H,K]),Ae=()=>{q([S]),E([D]),R({party:"",salesInvoiceNumber:"",invoiceDate:"",DueDate:"",items:_,additionalCharge:k,note:"",terms:"",discountType:"",discountAmount:"",discountPercentage:""})};return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(r.A,{title:"edit"==b?"Update Sales Invoice":"Add Sales Invoice"}),(0,A.jsxs)("main",{id:"main",children:[(0,A.jsx)(c.A,{}),(0,A.jsx)(v.A,{open:F}),(0,A.jsx)(f.A,{open:P}),(0,A.jsx)("div",{className:"content__body",children:(0,A.jsxs)("div",{className:"content__body__main bg-white",id:"addQuotationTable",children:[(0,A.jsx)("div",{className:"top__btn__grp",children:(0,A.jsx)("div",{className:"extra__btns"})}),(0,A.jsxs)("div",{className:"flex flex-col lg:flex-row items-center justify-around gap-4",children:[(0,A.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,A.jsxs)("p",{className:"text-xs",children:["Select Party ",(0,A.jsx)("span",{className:"required__text",children:"*"})]}),(0,A.jsx)(g.A,{model:"party",partyType:"customer",onType:e=>{R((0,a.A)((0,a.A)({},O),{},{party:e}))},value:null===(n=O.party)||void 0===n?void 0:n._id})]}),(0,A.jsxs)("div",{className:"flex flex-col gap-2 w-full lg:w-1/2",children:[(0,A.jsxs)("p",{className:"text-xs",children:["Sales Invoice Number ",(0,A.jsx)("span",{className:"required__text",children:"*"})]}),(0,A.jsx)("input",{type:"text",onChange:e=>R((0,a.A)((0,a.A)({},O),{},{salesInvoiceNumber:e.target.value})),value:O.salesInvoiceNumber||""})]}),(0,A.jsxs)("div",{className:"flex flex-col gap-2 w-full lg:w-1/2",children:[(0,A.jsxs)("p",{className:"text-xs",children:["Invoice Date ",(0,A.jsx)("span",{className:"required__text",children:"*"})]}),(0,A.jsx)("input",{type:"date",onChange:e=>{R((0,a.A)((0,a.A)({},O),{},{invoiceDate:e.target.value}))},value:O.invoiceDate||""})]}),(0,A.jsxs)("div",{className:"flex flex-col gap-2 w-full lg:w-1/2",children:[(0,A.jsx)("p",{className:"text-xs",children:"Due Date"}),(0,A.jsx)("input",{type:"date",onChange:e=>{R((0,a.A)((0,a.A)({},O),{},{DueDate:e.target.value}))},value:O.DueDate})]})]}),(0,A.jsx)("div",{className:"overflow-x-auto rounded",children:(0,A.jsxs)("table",{className:"add__table min-w-full table-style",children:[(0,A.jsx)("thead",{children:(0,A.jsxs)("tr",{children:[(0,A.jsx)("th",{style:{width:"*"},children:"Item"}),(0,A.jsx)("th",{style:{width:"6%"},children:"HSN/SAC"}),(0,A.jsx)("th",{style:{width:"5%"},children:"QTY"}),(0,A.jsx)("th",{style:{width:"7%"},children:"Unit"}),(0,A.jsx)("th",{style:{width:"10%"},children:"Price/Item"}),(0,A.jsx)("th",{style:{width:"10%"},children:"Discount"}),(0,A.jsx)("th",{style:{width:"10%"},children:"Tax"}),(0,A.jsx)("th",{style:{width:"10%"},children:"Amount"}),(0,A.jsx)("th",{style:{width:"3%"}})]})}),(0,A.jsx)("tbody",{children:_.map(((e,t)=>(0,A.jsxs)("tr",{className:"border-b",onClick:e=>{U.current=t},children:[(0,A.jsx)("td",{children:(0,A.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,A.jsx)(g.A,{model:"item",onType:e=>{de(e,t,ee,_,q,G,"sale"),e?(async(e,t)=>{try{const n="https://ezy-bill-api.tisindia.net/api/v1/purchaseinvoice/get-item-invoice",a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:m.A.get("token"),itemId:e})}),s=await a.json();if(200!==a.status)return N(s.err,"warning");q((n=>{const a=[...n];return a[t].itemInvoice=[],a[t].itemInvoiceList=s,s.forEach(((n,s)=>{const i=n.items.findIndex(((t,n)=>String(t.itemId)===String(e)));parseInt(n.items[i].qunLeft)>0&&(a[t].qunLeft=parseInt(a[t].qunLeft||0)+parseInt(n.items[i].qunLeft||0),a[t].itemInvoice.push({label:"".concat(n.purchaseInvoiceNumber," \t(Qun. ").concat(n.items[i].qunLeft," ").concat(n.items[i].selectedUnit,") \t(Exp. ").concat(n.items[i].expireDate.split("T")[0],")"),value:n.purchaseInvoiceNumber}))})),a}))}catch(n){return console.log(n),N("Invoice no get","error")}})(e,t):q((e=>{const n=[...e];return n[t].itemInvoice=[],n}))},value:_[t].itemId}),(0,A.jsx)(i.A,{data:_[t].itemInvoice,onChange:e=>{q((n=>{const a=[...n];return e.forEach(((e,n)=>{const s=a[t].itemInvoiceList.find(((t,n)=>t.purchaseInvoiceNumber===e));a[t].qunLeft=parseInt(a[t].qunLeft||0)+parseInt(s.items[0].qunLeft||0)})),a}))}}),(0,A.jsx)("input",{type:"text",className:"input-style",placeholder:"Description",onChange:e=>{let n=[..._];n[t].description=e.target.value,q(n)},value:_[t].description})]})}),(0,A.jsx)("td",{children:(0,A.jsx)("input",{type:"text",className:"w-[70px] input-style",onChange:e=>{let n=[..._];n[t].hsn=e.target.value,q(n)},value:_[t].hsn})}),(0,A.jsx)("td",{children:(0,A.jsx)("input",{type:"text",className:"input-style",onChange:e=>{if(parseInt(e.target.value)>_[t].qunLeft)return N("Insufficient stock","warning");let n=[..._];n[t].qun=e.target.value,q(n),V(e.target.value),O.discountType,fe(O.items[t].discountPerPercentage,t),ve(O.items[t].discountPerAmount,t)},value:_[t].qun})}),(0,A.jsx)("td",{children:(0,A.jsx)("select",{className:"input-style",onChange:e=>{let n=[..._];n[t].selectedUnit=e.target.value,q(n)},value:_[t].selectedUnit,children:_[t].unit.map(((e,t)=>(0,A.jsx)("option",{value:e,children:e},t)))})}),(0,A.jsx)("td",{align:"center",children:(0,A.jsx)("div",{children:(0,A.jsx)("input",{type:"text",className:"input-style",onChange:e=>{let n=[..._];n[t].price=e.target.value,q(n),J(e.target.value),O.discountType,fe(O.items[t].discountPerPercentage,t),ve(O.items[t].discountPerAmount,t)},value:_[t].price})})}),(0,A.jsxs)("td",{children:[" ",(0,A.jsxs)("div",{className:"w-[100px] flex flex-col gap-2 items-center",children:[(0,A.jsxs)("div",{className:"add-table-discount-input",children:[(0,A.jsx)("input",{type:"text",className:"".concat("before"===O.discountType?"bg-gray-100":""," "),onChange:"before"!==O.discountType?e=>{let n=(0,a.A)({},O);n.items[t].perDiscountType="amount",R((0,a.A)({},n)),ve(e.target.value,t)}:null,value:_[t].discountPerAmount}),(0,A.jsx)("div",{children:(0,A.jsx)(j.F.RUPES,{})})]}),(0,A.jsxs)("div",{className:"add-table-discount-input",children:[(0,A.jsx)("input",{type:"text",className:"".concat("before"===O.discountType?"bg-gray-100":""," "),onChange:"before"!==O.discountType?e=>{let n=(0,a.A)({},O);n.items[t].perDiscountType="percentage",R((0,a.A)({},n)),fe(e.target.value,t)}:null,value:_[t].discountPerPercentage}),(0,A.jsx)("div",{children:"%"})]})]})]}),(0,A.jsxs)("td",{children:[" ",(0,A.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,A.jsx)(l.A,{onChange:e=>{let n=[..._];n[t].tax=e,q(n),B("")},value:_[t].tax,data:re}),(0,A.jsx)("input",{type:"text",onChange:e=>{let n=[..._];n[t].taxAmount=e.target.value,q(n)},value:ge(t)})]})]}),(0,A.jsx)("td",{align:"center",children:(0,A.jsx)("div",{children:(0,A.jsx)("input",{type:"text",value:je(t),className:"bg-gray-100 custom-disabled",disabled:!0})})}),(0,A.jsx)("td",{align:"center",className:"w-[20px]",children:(0,A.jsx)(j.F.DELETE,{className:"cursor-pointer text-[16px]",onClick:()=>_.length>1&&pe(1,t,q,R,E)})})]},e.rowItem)))}),(0,A.jsxs)("tfoot",{children:[(0,A.jsx)("tr",{children:(0,A.jsx)("td",{colSpan:9,children:(0,A.jsxs)(o.A,{color:"blue",className:"float-right w-full font-bold",onClick:()=>ue(1,S,q,R,D,E),children:[(0,A.jsx)(j.F.ADD_LIST,{className:"text-lg mr-1"}),"Add Item"]})})}),(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{colSpan:5,align:"right",children:(0,A.jsx)("p",{className:"py-2 font-bold",children:"Sub-Total"})}),(0,A.jsx)("td",{children:ye()("discount")}),(0,A.jsx)("td",{children:ye()("tax")}),(0,A.jsx)("td",{children:ye()("amount")})]})]})]})}),(0,A.jsx)("div",{className:"overflow-x-auto rounded",id:"taxAmountTable",children:(0,A.jsxs)("table",{className:"table-style w-full",children:[(0,A.jsx)("thead",{children:(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{className:"font-bold",children:"Total Taxable Amount"}),(0,A.jsx)("td",{className:"font-bold",children:"Total Tax Amount"}),(0,A.jsxs)("td",{children:[(0,A.jsx)("span",{className:"font-bold mr-1",children:"Discount Type"}),(0,A.jsx)("span",{children:"(Additional)"})]}),(0,A.jsxs)("td",{children:[(0,A.jsx)("span",{className:"font-bold mr-1",children:"Discount Amount"}),(0,A.jsx)("span",{children:"(Additional)"})]}),(0,A.jsxs)("td",{children:[(0,A.jsx)("span",{className:"font-bold mr-1",children:"Discount Percentage"}),(0,A.jsx)("span",{children:"(Additional)"})]}),(0,A.jsx)("td",{className:"font-bold",children:"Total Amount"})]})}),(0,A.jsx)("tbody",{children:(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{className:"min-w-[150px]",children:(0,A.jsx)("input",{type:"text",name:"total_taxable_amount",value:(ye()("amount")-ye()("tax")).toFixed(2),className:"bg-gray-100 custom-disabled",disabled:!0})}),(0,A.jsx)("td",{className:"min-w-[150px]",children:(0,A.jsx)("input",{type:"text",name:"total_tax_amount",value:ye()("tax"),className:"bg-gray-100 custom-disabled",disabled:!0})}),(0,A.jsx)("td",{className:"min-w-[180px]",children:(0,A.jsxs)("select",{name:"discount_type",value:O.discountType,onChange:e=>{me(e,_,O,R,Y,N)},children:[(0,A.jsx)("option",{value:"no",children:"No Discount"}),(0,A.jsx)("option",{value:"before",children:"Before Tax"}),(0,A.jsx)("option",{value:"after",children:"After Tax"})]})}),(0,A.jsx)("td",{className:"min-w-[180px]",children:(0,A.jsxs)("div",{className:"add-table-discount-input",children:[(0,A.jsx)("input",{id:"discountAmount",type:"text",className:"".concat(W?"bg-gray-100 custom-disabled":""),disabled:!!W,onChange:e=>W?null:(e=>{if(null!==W){let t=((e.target.value||(0).toFixed(2))/ye()("amount")*100).toFixed(2);R((0,a.A)((0,a.A)({},O),{},{discountAmount:e.target.value,discountPercentage:t}))}})(e),value:O.discountAmount}),(0,A.jsx)("div",{children:(0,A.jsx)(j.F.RUPES,{})})]})}),(0,A.jsx)("td",{className:"min-w-[200px]",children:(0,A.jsxs)("div",{className:"add-table-discount-input",children:[(0,A.jsx)("input",{type:"text",id:"discountPercentage",className:"".concat(W?"bg-gray-100 custom-disabled":""),disabled:!!W,onChange:W?null:e=>{let t=(ye()("amount")/100*e.target.value).toFixed(2);if(R((0,a.A)((0,a.A)({},O),{},{discountPercentage:e.target.value,discountAmount:t})),"before"===O.discountType){let t=[..._];t.forEach(((t,n)=>{t.discountPerPercentage=e.target.value})),q([...t])}},value:O.discountPercentage}),(0,A.jsx)("div",{children:"%"})]})}),(0,A.jsx)("td",{className:"min-w-[150px]",children:(0,A.jsx)("input",{type:"text",name:"total_amount",className:"bg-gray-100 custom-disabled",disabled:!0,value:ye()("amount"),onChange:null})})]})})]})}),(0,A.jsxs)("div",{className:"w-full flex flex-col lg:flex-row justify-between gap-4 mt-3",children:[(0,A.jsxs)("div",{className:"flex flex-col w-full gap-3",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{children:"Note: "}),(0,A.jsx)("input",{type:"text",onChange:e=>R((0,a.A)((0,a.A)({},O),{},{note:e.target.value})),value:O.note})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{children:"Terms:"}),(0,A.jsx)("input",{type:"text",onChange:e=>R((0,a.A)((0,a.A)({},O),{},{terms:e.target.value})),value:O.terms})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{children:"Payment Status:"}),(0,A.jsxs)("select",{onChange:e=>{R((0,a.A)((0,a.A)({},O),{},{paymentStatus:e.target.value}))},value:O.paymentStatus,children:[(0,A.jsx)("option",{value:"0",children:"Not Paid"}),(0,A.jsx)("option",{value:"1",children:"Full Paid"}),(0,A.jsx)("option",{value:"2",children:"Partial Paid"})]})]}),"1"===O.paymentStatus||"2"===O.paymentStatus?(0,A.jsxs)("div",{className:"flex items-center gap-2",children:[(0,A.jsxs)("div",{className:"w-full",children:[(0,A.jsx)("p",{children:"Amount:"}),(0,A.jsx)("input",{type:"text",onChange:e=>R((0,a.A)((0,a.A)({},O),{},{paymentAmount:e.target.value})),value:O.paymentAmount})]}),(0,A.jsxs)("div",{className:"w-full",children:[(0,A.jsx)("p",{children:"Select Account:"}),(0,A.jsxs)("select",{onChange:e=>{R((0,a.A)((0,a.A)({},O),{},{paymentAccount:e.target.value}))},value:O.paymentAccount,children:[(0,A.jsx)("option",{value:"",children:"--Select Account--"}),se.map(((e,t)=>(0,A.jsx)("option",{value:e._id,children:e.title},t)))]})]})]}):null]}),(0,A.jsxs)("div",{className:"w-full",children:[(0,A.jsx)("div",{className:"uppercase font-bold border border-dashed p-2 rounded",children:"Additional Charges"}),(0,A.jsx)("div",{className:"overflow-x-auto rounded mt-3",id:"addtionalChargeTable",children:(0,A.jsxs)("table",{className:"table-style w-full",children:[(0,A.jsx)("thead",{className:"bg-gray-100",children:(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{children:"Particular"}),(0,A.jsx)("td",{children:"Amount"}),(0,A.jsx)("td",{children:"Actions"})]})}),(0,A.jsx)("tbody",{children:k.map(((e,t)=>(0,A.jsxs)("tr",{children:[(0,A.jsx)("td",{children:(0,A.jsx)("input",{type:"text",onChange:e=>{let n=[...k];n[t].particular=e.target.value,E(n)},value:k[t].particular})}),(0,A.jsx)("td",{children:(0,A.jsx)("input",{type:"text",onChange:e=>{let n=[...k];n[t].amount=e.target.value,E(n)},value:k[t].amount})}),(0,A.jsx)("td",{align:"center",children:(0,A.jsx)(j.F.DELETE,{className:"cursor-pointer text-lg",onClick:()=>pe(2,t,q,R,E)})})]},e.additionalRowsItem)))}),(0,A.jsx)("tfoot",{children:(0,A.jsx)("tr",{children:(0,A.jsx)("td",{colSpan:3,children:(0,A.jsxs)(o.A,{color:"blue",className:"float-right w-full font-bold",onClick:()=>ue(2,S,q,R,D,E),children:[(0,A.jsx)(j.F.ADD_LIST,{className:"text-lg mr-1"}),"Add Item"]})})})})]})}),(0,A.jsxs)("div",{className:"flex justify-between items-center w-full mt-4 round__off__section",children:[(0,A.jsxs)("div",{className:"flex items-center gap-1",children:[(0,A.jsx)("input",{type:"checkbox",onChange:e=>R((0,a.A)((0,a.A)({},O),{},{autoRoundOff:e.target.checked})),checked:O.autoRoundOff}),(0,A.jsx)("p",{children:"Auto Round Off"})]}),!O.autoRoundOff&&(0,A.jsx)("div",{children:(0,A.jsxs)("div",{className:"flex items-center text-sm",children:[(0,A.jsxs)("button",{onClick:()=>{R((0,a.A)((0,a.A)({},O),{},{roundOffType:"1"}))},className:"flex items-center text-[10px] border ".concat("1"===O.roundOffType?"border-blue-700":""," p-[2px]"),children:["Add ",(0,A.jsx)("span",{children:"(+)"})]}),(0,A.jsx)("input",{type:"text",className:"w-[100px]",value:O.roundOffAmount,onChange:e=>R((0,a.A)((0,a.A)({},O),{},{roundOffAmount:e.target.value}))}),(0,A.jsxs)("button",{onClick:()=>{R((0,a.A)((0,a.A)({},O),{},{roundOffType:"0"}))},className:"flex items-center text-[10px] border ".concat("0"===O.roundOffType?"border-blue-700":""," p-[2px]"),children:["Reduce ",(0,A.jsx)("span",{children:"(-)"})]})]})})]}),(0,A.jsx)("p",{className:"font-bold mt-4 mb-2",children:"Final Amount"}),(0,A.jsx)("input",{type:"text",name:"final_amount",className:"bg-gray-100 custom-disabled w-full",disabled:!0,value:O.finalAmount})]})]}),(0,A.jsxs)("div",{className:"w-full flex justify-center gap-3 my-3 mt-5",children:[(0,A.jsxs)("button",{onClick:async()=>{if(!O.party)return N("Please select party","error");if(!O.salesInvoiceNumber)return N("Please enter invoice number","error");if(!O.invoiceDate)return N("Please select invoice date","error");for(let t of _){if(""===t.itemName)return N("Please select item","error");if(""===t.qun)return N("Please enter quantity","error");if(""===t.unit)return N("Please select unit","error");if(""===t.price)return N("Please enter price","error")}_.forEach(((e,t)=>{e.taxAmount=ge(t),e.amount=je(t)})),q([..._]);try{const t="https://ezy-bill-api.tisindia.net/api/v1/salesinvoice/add",n=m.A.get("token"),s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b&&"edit"===b?(0,a.A)((0,a.A)({},O),{},{token:n,update:!0,id:w}):(0,a.A)((0,a.A)({},O),{},{token:n}))}),i=await s.json();if(200!==s.status||i.err)return N(i.err,"error");if("edit"===b)return N("Invoice update successfully","success"),void C(-1);if(Ae(),"convert"===b&&"proforma"===L)try{await fetch("https://ezy-bill-api.tisindia.net/api/v1/proforma/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:[w],trash:!1})})}catch(e){console.log("Proforma not deleted: "+e)}else if("convert"===b&&"quotation"===L)try{const e="https://ezy-bill-api.tisindia.net/api/v1/quotation/add";await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:n,id:w,update:!0,billStatus:"convert"})})}catch(e){return console.log(e),N("Quotation status not change","error")}return N("Invoice add successfully","success"),void C("/admin/sales-invoice")}catch(e){return console.log(e),N("Something went wrong","error")}},className:"add-bill-btn",children:[(0,A.jsx)(j.F.CHECK,{}),b&&"convert"!==b?"Update":"Save"]}),(0,A.jsxs)("button",{className:"reset-bill-btn",onClick:Ae,children:[(0,A.jsx)(j.F.RESET,{}),"Reset"]})]})]})})]})]})}}}]);
//# sourceMappingURL=1073.72df8405.chunk.js.map